<%- include('partials/header'); -%>

<head>
  <style>
  * {
    box-sizing: border-box;
  }

/*the container must be positioned relative:*/
.autocomplete {
  position: relative;
  display: inline-block;
}


.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}

.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff;
  border-bottom: 1px solid #d4d4d4;
}

/*when hovering an item:*/
.autocomplete-items div:hover {
  background-color: #e9e9e9;
}

/*when navigating through the items using the arrow keys:*/
.autocomplete-active {
  background-color: DodgerBlue !important;
  color: #ffffff;
}
.tag {
  border-radius: 11px;
  font-size: 13px;
  margin:8px;
  background: #f4f4ff;
  border-radius: 42px;
  color: #4444ff;
}
.pointer{
  cursor: pointer;
}

</style>
<body id="page-top">
  <!-- Page Wrapper -->
  <div id="wrapper">
    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">
      <!-- Main Content -->
      <div id="content">
        <%- include('./partials/nav'); -%>

        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid">


          <!-- small modal for add university -->

          <div class="modal fade" tabindex="-1" role="dialog" id="addUni" aria-labelledby="addUni" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header" style="border-bottom:0;">
                  <h5 class="modal-title">Agregar</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" class="px-2" id="modalClose">&times;</span>
                  </button>
                </div>
                <form enctype='application/json' method="post">
                  <div class="modal-body">
                    <div class="container-fluid" style="margin-top: 0 !important;">
                      <div class="row">
                        <div class="col-12 selects">
                          <label for="add_university">QUE DESEA AÑADIR?</label><br>
                          <div class="row">
                            <div class="col-12">
                              <select name="add_university" id="add_university" class="form-control form-input" style="padding:0.35rem;" required>
                                <option value="Universidad" selected>Universidad</option>
                                <option value="Carrera">Carrera</option>
                                <option value="Categoría Laboral">Categoría Laboral</option>
                              </select>
                            </div>
                          </div>
                        </div>
                        <div class="col-12 universityStuff">
                          <label for="university_name">UNIVERSIDAD</label><br>
                          <input type="text" class="form-control form-input" name="university_name" id="university_name" required>
                        </div>
                        <div class="col-12 selects universityStuff">
                          <label for="university_country">PAÍS DE LA UNIVERSIDAD</label><br>
                          <select class="form-control form-input" name="university_country" id="university_country" style="color: #2a2a35" required>
                            <% countries.forEach(function(country){ %>
                              <option>
                                <%= country %>
                              </option>
                              <% }); %>
                          </select>
                        </div>
                        <div class="col-12 careerStuff d-none">
                          <label for="university_career">CARRERA</label><br>
                          <input type="text" class="form-control form-input" name="university_career" id="university_career" required>
                        </div>
                        <div class="col-12 workStuff d-none">
                          <label for="work_category">CATEGORÍA LABORAL</label><br>
                          <input type="text" class="form-control form-input" name="work_category" id="work_category" required>
                        </div>
                        <div class="col-12 workStuff d-none">
                          <label for="work_subcategory">SUBCATEGORÍA LABORAL</label><br>
                          <input type="text" class="form-control form-input" name="work_subcategory" id="work_subcategory">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer" style="border-top:0;">
                    <div class="container-fluid" style="margin-top: 0 !important;">
                      <div class="row">
                        <div class="col-12 text-center">
                          <button id="addUniversity" type="submit" class="label_style" style="width: 100% !important;">Enviar</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>

        <!-- Page Heading -->
        <div class="d-sm-flex align-items-center justify-content-between mb-4" style="margin: 50px 0 0px 0;">
        <a class="fas fa-arrow-left" style="width: auto !important;" href="/client"><p style="font-family: Quicksand; display: inline-block;">&nbsp&nbsp Volver a inicio </p></a></div>

        <!-- Content Row -->
        <div class="row">
          <div class="col col-md-3">
            <div class="card" style="background-color: transparent; padding: 0;">
              <img src="<%= user.photo %>" alt="..." style="border-radius: 15px; width: auto; height: 250px; object-fit: cover;">
            </div>
            <div class="card mb-4" style="box-shadow: none; padding: 0;">
              <!-- Card Body -->
              <div class="card-body">
                <ul id="progressbar" style="margin: 0; padding: 0; list-style:none">
                  <li><a class="fas fa-user user_style" style="width: auto !important; margin: 20px 0;"><p style="font-family: Quicksand; display: inline-block; color: #4444ff;">&nbsp;&nbsp; Información personal </p></a></li>
                  <li><a class="fas fa-book-open user_style_disallow" style="width: auto !important; margin: 20px 0;"><p style="font-family: Quicksand; display: inline-block; color: #d8d8d8;">&nbsp;&nbsp; Información académica </p></a></li>
                  <li><a class="fas fa-laptop user_style_disallow" style="width: auto !important; margin: 20px 0;"><p style="font-family: Quicksand; display: inline-block; color: #d8d8d8;">&nbsp;&nbsp; Información laboral </p></a></li>
                  <li><a class="fas fa-address-card user_style_disallow" style="width: auto !important; margin: 20px 0;"><p style="font-family: Quicksand; display: inline-block; color: #d8d8d8;">&nbsp;&nbsp; Intereses </p></a></li>
                </ul>
              </div>
              <div class="card-body text-center">
                <button type="button" class="label_style" style="font-size: 20px;"id="submitBtn" style="font-weight: bold !important; color: #fff !important">Guardar cambios</button>
              </div>
            </div>
          </div>
          <div class="col col-md">
            <div class="card" style="box-shadow: none">
              <h1 style="color: #4444ff; font-weight: bold;"><%= user.firstname %> <%= user.lastname %></h1>
              <p style="color: #2a2a35;">Miembro desde el <%= user.createdAt %></p>
              <div class="row no-gutters">
                <div class="col-xl col-md">
                  <div class="row" style="margin-top: 25px;">
                    <div class="col-sm-6 col-xl delete_after" style="margin-bottom: 20px;">
                      <div class="card border-35 asilinks-card white-bg black-shadow h-100">
                        <div class="card-body small-title">
                          <div class="row">
                            <div class="col-9">
                              <div class="row">
                                <div class="col-12" style="color: #4444ff;">
                                  <b>Socios</b>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-12" style="color: #2a2a35">
                                  Siempre serán tuyos ❤️
                                </div>
                              </div>
                            </div>
                            <div class="col-3 center-vert px-1">
                              <div class="row">
                                <div class="col-12 red-text pl-1">
                                  <b class="border-half pink-bg p-2" style="background: #f4f4ff; border-radius: 42px; color: #4444ff;">0</b>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-6 col-xl delete_after" style="margin-bottom: 20px;">
                      <div class="card border-35 asilinks-card white-bg black-shadow h-100">
                        <div class="card-body small-title">
                          <div class="row">
                            <div class="col-9">
                              <div class="row">
                                <div class="col-12" style="color: #4444ff;">
                                  <b>Referidos</b>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-12" style="color: #2a2a35">
                                  Clientes y socios
                                </div>
                              </div>
                            </div>
                            <div class="col-3 center-vert px-1">
                              <div class="row">
                                <div class="col-12 red-text pl-1">
                                  <b class="border-half pink-bg p-2" style="background: #f4f4ff; border-radius: 42px; color: #4444ff;"><%= users.length %>
                                  </b>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-6 col-xl delete_after" style="margin-bottom: 20px;">
                      <div class="card border-35 asilinks-card white-bg black-shadow h-100">
                        <div class="card-body small-title">
                          <div class="row">
                            <div class="col-9">
                              <div class="row">
                                <div class="col-12" style="color: #4444ff;">
                                  <b>Requerimientos</b>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-12" style="color: #2a2a35">
                                  En proceso y terminadas
                                </div>
                              </div>
                            </div>
                            <div class="col-3 center-vert px-1">
                              <div class="row">
                                <div class="col-12 red-text pl-1">
                                  <b class="border-half pink-bg p-2" style="background: #f4f4ff; border-radius: 42px; color: #4444ff;">0</b>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Form -->
                  <div class="col-xl col-lg" style="margin-top: 50px;">
                    <div class="card shadow mb-4">
                      <!-- Card Body -->
                      <div class="card-body">
                        <form id="steps_process" enctype="multipart/form-data" action="/client/updateInfo" method="post">
                          <fieldset>
                            <div class="form-group row">
                              <div class="col-sm-6 delete_after">
                                <label for="title" for="firstname" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">NOMBRE</label>
                                <input type="text" class="form-control" name="firstname" id="firstname" placeholder="" style="color: #2a2a35" value="<%=user.firstname%>">
                              </div>
                              <div class="col-sm-6 delete_after">
                                <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="lastname">APELLIDO</label>
                                <input type="text" class="form-control" placeholder="" style="color: #2a2a35" name="lastname" id="lastname" value="<%=user.lastname%>">
                              </div>
                            </div>
                            <div class="form-group row">
                              <div class="col-sm-6 delete_after">
                                <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="firstname">DOCUMENTO DE IDENTIDAD</label>
                                <input type="text" class="form-control" id="title" placeholder="" style="color: #2a2a35"  name="userId" id="userId" value="<%=user.userId%>">
                              </div>
                              <div class="col-sm-6 delete_after">
                                <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">FECHA DE NACIMIENTO</label>
                                <input type="date" class="form-control" name="dob" id="dob" value="<%=birthday%>" title="Debes ser mayor de 13 años para registrarte">
                              </div>
                            </div>
                            <div class="form-group row">
                              <div class="col-sm-6">
                                <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="bornCountry">PAIS DE NACIMIENTO</label>
                                <select class="form-control" style="color: #2a2a35" name="bornCountry" id="bornCountry">
                                  <% countries.forEach(function(country){ %>
                                    <option value="<%= country %>"
                                      <% if (country == user.country) { %>
                                        selected
                                        <% } %> > <%= country %></option>
                                        <% }); %>
                                      </select>
                                    </div>
                                    <div class="col-sm-6 delete_after">
                                      <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="lastname">CIUDAD DE RESIDENCIA</label>
                                      <input type="text" class="form-control" id="title" placeholder="" style="color: #2a2a35"  name="livingCity" id="livingCity" value="<%=user.city%>">
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <div class="col-sm-3" style="">
                                      <p class="mb-0 text-left" style="font-weight: normal; white-space: nowrap; color: #bcbcca; font-weight: bold;">FOTO DE PERFIL</p>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <span>
                                      <input type="file" accept=".jpg,.jpeg,.png" name="profPic" id="profPic" class="inputfile"/>
                                      <label for="profPic" id="profile_file" class="label_style"><span>Cambiar foto</span></label>
                                    </span>
                                  </div>
                                  <div class="form-group row">
                                    <div class="col-sm-3" style="margin-top: 50px;">
                                      <p class="mb-0 text-left" style="font-weight: normal; white-space: nowrap; color: #bcbcca; font-weight: bold;">GÉNERO</p>
                                    </div>
                                  </div>
                                  <section class="radio_requeriments2" id="tabs3-2" style="margin-bottom: 50px;">
                                    <label>
                                      <input type="radio" name="radio2" value="Femenino" id="radio00">
                                      <div class="btn_nav3 btn-sik3"><span>Femenino</span></div>
                                    </label>
                                    <label>
                                      <input type="radio" name="radio2" value="Masculino" id="radio11">
                                      <div class="btn_nav3 btn-sik3"><span>Masculino</span></div>
                                    </label>
                                    <label>
                                      <input type="radio" name="radio2" value="Indefinido" id="radio22">
                                      <div class="btn_nav3 btn-sik3"><span>Indefinido</span></div>
                                    </label>
                                  </section>
                                  <button type="button" class="btn btn-primary px-4 float-right label_style steps1" style="font-weight: bold;">Siguiente</button>
                                </fieldset>
                              <fieldset>
                                <div class="form-group row">
                                  <div class="col-sm-6">
                                    <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">¿EN QUE PAIS ESTUDIASTE?</label>
                                    <select class="form-control" name="studyCountry" id="studyCountry" style="color: #2a2a35" onchange="loadUni()">
                                      <% countries.forEach(function(country){ %>
                                        <option value="<%= country %>"
                                          <% if (country == user.studyInfo.studyCountry) { %>
                                            selected
                                            <% } %> > <%= country %>
                                        </option>
                                      <% }); %>
                                    </select>
                                  </div>
                                  <div class="col-sm-6 delete_after">
                                    <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;"></label>
                                  </div>
                                </div>
                                <div class="form-group row">
                                  <div class="col-sm-6">
                                    <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">INSTITUCIÓN</label>
                                    <select class="form-control" id="institution" style="color: #2a2a35" name="institution" onchange="loadCareers()">
                                    </select>
                                  </div>
                                  <div class="col-sm-6 delete_after">
                                    <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">¿No encuentras tu institución?<a href="#" data-toggle="modal" data-target="#addUni"> ¡Agrégala aquí!</a></label>
                                  </div>
                                </div>
                                <div class="form-group row">
                                  <div class="col-sm-6">
                                    <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="firstname">CARRERA</label>
                                    <select class="form-control" style="color: #2a2a35" name="career" id="career">
                                    </select>
                                  </div>
                                  <div class="col-sm-6 delete_after">
                                    <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">¿No encuentras tu carrera?<a href="#" data-toggle="modal" data-target="#addUni"> ¡Agrégala aquí!</a></label>
                                  </div>
                                </div>
                                <div class="form-group row">
                                  <div class="col-sm-6 delete_after">
                                    <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="lastname">ESPECIALIDAD</label>
                                    <input type="text" class="form-control" id="title" placeholder="" style="color: #2a2a35"  name="specialty" id="specialty" value="<%=user.studyInfo.specialty%>">
                                  </div>
                                  <div class="col-sm-6 delete_after">
                                    <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;"></label>
                                  </div>
                                </div>
                                <button type="button" class="btn btn-primary px-4 float-left label_style return" style="font-weight: bold;">Anterior</button>
                                <button type="button" class="btn btn-primary px-4 float-right label_style steps1" style="font-weight: bold;">Siguiente</button>
                              </fieldset>
                              <fieldset>
                              <div class="form-group row">
                                <div class="col-sm-6">
                                  <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">AÑOS DE EXPERIENCIA</label>
                                  <select class="form-control" id="yearsExp" name="yearsExp" style="color: #2a2a35">
                                    <option value="0-5" selected>0-5</option>
                                    <option value="5-10">5-10</option>
                                    <option value="10-15">10-15</option>
                                    <option value="15-20">15-20</option>
                                    <option value="20+">20+</option>
                                  </select>
                                </div>
                                <div class="col-sm-6 delete_after">
                                  <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;"></label>
                                </div>
                              </div>
                              <div class="form-group row">
                                <div class="col-sm-6 delete_after">
                                  <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">RESUMEN CURRICULAR</label>
                                  <span>
                                    <input type="file" accept=".doc,.docx,.pdf" name="resume" id="resume" class="inputfile" data-multiple-caption="{count} archivos seleccionados" multiple="">
                                    <label for="resume" class="label_style" id="resume_file">
                                      <% if(!user.workInfo.fileOfName) { %>
                                        <span>Adjuntar archivo(s) &nbsp;</span>
                                        <i class="fa fa-paperclip" aria-hidden="true"></i>
                                        <% } else { %>
                                          <span><%=user.workInfo.fileOfName %></span>
                                          <% } %>
                                        </label>
                                  </span>
                                </div>
                                <div class="col-sm-6 delete_after">
                                  <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;"></label>
                                </div>
                              </div>
                              <div class="form-group row">
                                <div class="col-sm-6">
                                  <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="firstname">CATEGORÍA LABORAL</label>

                                  <div class="autocomplete" style="width:100%;">
                                    <input class="form-input mt-2" id="categorySearch" type="text" autocomplete="off" placeholder="Escribe una categoría o subcategoría" style="width:100%;"/>
                                  </div>

                                  <br>
                                  <div id="tags" class="row">
                                    <% if (user.workInfo && user.workInfo.categories) { %>
                                    <% user.workInfo.categories.forEach((item, i) => { %>
                                      <div class="col pink-bg p-2 tag" id="<%= item.categoryID %>_category">
                                        <label class="red-text"><%= item.workCategory %> | <%= item.workSub %><span class="fa fa-times pointer" onclick="removeTag('<%= item.categoryID %>','category')"></span></label>
                                      </div>
                                    <% }); %>
                                    <% } %>
                                  </div>

                                  <!-- <select class="form-control" style="color: #2a2a35" name="workCategory" id="workCategory" onchange="loadCategories()">
                                    <% category.forEach(function(cat){ %>
                                      <option value="<%= cat %>"
                                        <% if (cat == user.workInfo.workCategory) { %>
                                          selected
                                          <% } %> > <%= cat %>
                                      </option>
                                    <% }); %>
                                  </select> -->
                                </div>
                                <div class="col-sm-6 delete_after">
                                  <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">¿No encuentras tu categoría?<a href="#" data-toggle="modal" data-target="#addUni"> ¡Agrégala aquí!</a></label>
                                </div>
                              </div>
                              <!-- <div class="form-group row">
                                <div class="col-sm-6">
                                  <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="workSub">SUBCATEGORÍA LABORAL</label>
                                  <select class="form-control" name="workSub" id="workSub" style="color: #2a2a35">
                                  </select>
                                </div>
                                <div class="col-sm-6 delete_after">
                                  <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">¿No lo encuentras?<a href="#" data-toggle="modal" data-target="#addUni"> ¡Agrégala aquí!</a></label>
                                </div>
                              </div> -->
                              <button type="button" class="btn btn-primary px-4 text-center label_style return" style="font-weight: bold;">Anterior</button>
                              <button type="button" class="btn btn-primary px-4 float-right label_style steps1" style="font-weight: bold;">Siguiente</button>
                            </fieldset>
                            <fieldset>

                            <div class="form-group row">
                              <div class="col-sm-6">
                                <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;" for="firstname">CATEGORÍAS Y SUBCATEGORÍAS DE INTERÉS </label>

                                <div class="autocomplete" style="width:100%;">
                                  <input class="form-input mt-2" id="interestSearch" type="text" autocomplete="off" placeholder="Escribe una categoría o subcategoría" style="width:100%;"/>
                                </div>

                                <br>
                                <div id="searchTags" class="row">
                                  <% if (user.interest) { %>
                                  <% user.interest.forEach((item, i) => { %>
                                    <div class="col pink-bg p-2 tag" id="<%= item.categoryID %>_interest">
                                      <label class="red-text"><%= item.workCategory %> | <%= item.workSub %><span class="fa fa-times pointer" onclick="removeTag('<%= item.categoryID %>','interest')"></span></label>
                                    </div>
                                  <% }); %>
                                  <% } %>
                                </div>
                              </div>
                              <div class="col-sm-6 delete_after">
                                <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">¿No encuentras tu categoría?<a href="#" data-toggle="modal" data-target="#addUni"> ¡Agrégala aquí!</a></label>
                              </div>
                            </div>
                            <button type="button" class="btn btn-primary px-4 text-center label_style return" style="font-weight: bold;">Anterior</button>
                          </fieldset>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
          <!-- /.container-fluid -->


      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <%- include('./partials/footer'); -%>
      <!-- End of Footer -->
    </div>
    <!-- End of Content Wrapper -->

    <%- include('./partials/sidebar'); -%>
  </div>
</body>

<script type="text/javascript">
  $("#workerBtn2").click(function() {

      $.post("/api/users/changeWork")
      .done( function(data){

          location.reload();

      })
      .fail( function(xhr, textStatus, errorThrown){

          console.log(xhr.responseText)
          alert("Error guardando al usuario! " + xhr.responseText)

      });


  });

	function checkSingleDigit(info){

	 	if(info < 10){
	        info = '0' + info;
	    }

	    return info;

	}

	function loadCategories() {

    var category = $("#workCategory").val()

    var subcategory = '<%= user.workInfo.workSub %>';

		$.get("/client/getSubcategories/" + category)
		  .done( function(data){

		      console.log('subcategorias cargadas con exito!');
		      $('#workSub').empty()

		      if (Array.isArray(data) && data.length){

		        data.forEach((sub) =>{

		          $('#workSub').append($('<option>', {
		            value: sub.sub_category,
		            text: sub.sub_category
		          }));

            })

          $('#workSub').find("option[value='" + subcategory +"']").attr('selected', true);

		      }

		  })
		  .fail( function(xhr, textStatus, errorThrown){

		    console.log(errorThrown)
		    alert('Error en la carga de Universidades');

		  });

	}

	function loadUni() {

		var studyCountry = $("#studyCountry").val()

		var userUni = '<%= user.studyInfo.institution %>';

		$.get("/client/getUniversities/" + studyCountry)
	        .done( function(data){

	          	console.log('universidades cargadas con exito!');
        $('#institution').empty()
        $('#career').empty()

	          	if (Array.isArray(data) && data.length){

					data.forEach((uni) =>{

						$('#institution').append($('<option>', {
							value: uni.name,
							text: uni.name
						}));

					})

        $('#institution').find("option[value='" + userUni +"']").attr('selected', true);

        loadCareers();

	          }

	        })
	        .fail( function(xhr, textStatus, errorThrown){

	          console.log(errorThrown)
	          alert('Error en la carga de Universidades');

	        });

  }

        function loadCareers() {

          var userUni = $("#institution").val()

          var userCareer = '<%= user.studyInfo.career %>';

            $.get("/client/getCareers/" + userUni)
              .done( function(data){

          console.log('carreras cargadas con exito!');
          $('#career').empty()

          if (Array.isArray(data) && data.length){

            data.forEach((car) =>{

            $('#career').append($('<option>', {
            value: car.career,
            text: car.career
        }));

      })

    $('#career').find("option[value='" + userCareer +"']").attr('selected', true);

        }

      })
      .fail( function(xhr, textStatus, errorThrown){

        console.log(errorThrown)
        alert('Error en la carga de carreras');

      });

}

	// Actualiza los selects al cargar la pagina para que tenga seleccioanda las opciones del usuario
	function updateSelects(){

    var userUni = '<%= user.workInfo.yearsExp %>';

    var gender = '<%= user.gender %>';

        $('#yearsExp').find("option[value='" + userUni +"']").attr('selected', true);
        //$("input[name=""]radio[value="+gender+"]").attr("checked","checked");
        $('input[name=radio2]').each(function() {
           if ($(this).val() == gender){
             $(this).attr("checked","checked");
           }

        });


  }

 	$(document).ready(function(){

 		$("#studyCountry").change();
    $("#workCategory").change();

 		updateSelects();

	    $(".info-option").on("click", function(){

	        $(".personal-info").addClass("d-none");
        	var toCollapse = $(this).data( "target" );

        	$(toCollapse).removeClass("d-none");

	        $(".info-option.active").not($(this)).removeClass("active");
	        $(this).addClass("active");

	    });

	    $(".form-input").on("change", function(){

	        $("#addUniversity").prop('disabled', false)

	    });

	    $("#resume").on("change", function(){

	        $("#saveChanges").prop('disabled', false)

	    });

		$("#resume").change(function() {

			if (!this.files[0])
				return $("#resume_file").html("<span>Adjuntar archivo &nbsp</span><i class='fa fa-paperclip' aria-hidden='true'></i>")

			$("#resume_file").text(this.files[0].name)

		});

    $("#profPic").change(function() {

			if (!this.files[0]) {
        return $("#profile_file").html("<span>Adjuntar foto &nbsp</span><i class='fa fa-paperclip' aria-hidden='true'></i>")
      } else {
        if (this.files[0].size > 1048576) {
          alert("Tu foto de perfil no puede pesar más de 1 MB");
          return $("#profile_file").html("<span>Adjuntar foto &nbsp</span><i class='fa fa-paperclip' aria-hidden='true'></i>")
        } else {
          $("#profile_file").text(this.files[0].name)
        }
      }
		});

		var today = new Date();
		// Minimo de 13 años para crearse una cuenta
		var year = today.getFullYear() - 13
		var month = today.getMonth() + 1
		var day = today.getDate()

	    day = checkSingleDigit(day);
	    month = checkSingleDigit(month);

	    year = year.toString();
		month = month.toString();
		day = day.toString();

		var fullDate = year +'-'+ month +'-'+ day
		console.log(fullDate)

		// Pone el limite al calendario
		document.getElementById("dob").setAttribute("max", fullDate);

    });

 	function sendResume(){

 		var myFormData = new FormData();
 		var fileInput = document.getElementById("resume");
 		console.log(fileInput.files[0])
		myFormData.append('resume', fileInput.files[0]);
		console.log(myFormData)
		$.ajax({
		  	url: '/client/sendResume',
		  	type: 'POST',
		  	processData: false, // important
		  	contentType: false, // important
		  	data: myFormData
		})
      	.done( function(data){

        	console.log('resume sent succesfully');

      	})
      	.fail( function(xhr, textStatus, errorThrown){

        	console.log(errorThrown)
        	console.log('failed sending resume');
        	//$('#errorModal').modal('show');

      	});

   }

   $("#add_university").change(function() {

var type = $(this).val();

if (type == "Universidad"){

  $(".universityStuff").removeClass("d-none");
  $(".careerStuff").addClass("d-none");
  $(".workStuff").addClass("d-none");

} else if (type == "Carrera"){

  $(".universityStuff").removeClass("d-none");
  $(".careerStuff").removeClass("d-none");
  $(".workStuff").addClass("d-none");

} else if (type == "Categoría Laboral"){

  $(".universityStuff").addClass("d-none");
  $(".careerStuff").addClass("d-none");
  $(".workStuff").removeClass("d-none");

}


})

function getFormInfo(){

var allInputs = $(".form-input")
var objectInfo = {};

for (var i = 0; i < allInputs.length; i++){
  objectInfo[allInputs[i].id] = allInputs[i].value;
}

return objectInfo;
}


$("#addUniversity").click(function(){

var universityInfo = getFormInfo();
console.log(universityInfo)

$.post("/db/addUniversity",
  universityInfo
)
.done( function(data){

  alert("Solicitud envíada con éxito")
  $('#addUni').modal("hide")

})
.fail( function(xhr, textStatus, errorThrown){

    console.log(xhr.responseText)
    alert("Error enviando la solicitud! " + xhr.responseText)

});

return false;

})

</script>
<script type="text/javascript">

  var categoriesAsTags = <%- JSON.stringify(user.workInfo.categories) %> || [];
  var interestAsTags = <%- JSON.stringify(user.interest) %> || [];
function autocomplete(inp, arr,type) {
/*the autocomplete function takes two arguments,
the text field element and an array of possible autocompleted values:*/
var currentFocus;
/*execute a function when someone writes in the text field:*/
inp.addEventListener("input", function(e) {
    var a, b, i, val = this.value;
    /*close any already open lists of autocompleted values*/
    closeAllLists();
    if (!val) { return false;}
    currentFocus = -1;
    /*create a DIV element that will contain the items (values):*/
    a = document.createElement("DIV");
    a.setAttribute("id", this.id + "autocomplete-list");
    a.setAttribute("class", "autocomplete-items");
    /*append the DIV element as a child of the autocomplete container:*/
    this.parentNode.appendChild(a);
    /*for each item in the array...*/
    for (i = 0; i < arr.length; i++) {
      /*check if the item starts with the same letters as the text field value:*/
      if (arr[i].category.substr(0, val.length).toUpperCase() == val.toUpperCase()
      || arr[i].sub_category.substr(0, val.length).toUpperCase() == val.toUpperCase()
      || (arr[i].sub_category.split(" ")[1] && arr[i].sub_category.split(" ")[1].substr(0, val.length).toUpperCase() == val.toUpperCase())
      || (arr[i].sub_category.split(" ")[2] && arr[i].sub_category.split(" ")[2].substr(0, val.length).toUpperCase() == val.toUpperCase())) {
        /*create a DIV element for each matching element:*/
        b = document.createElement("DIV");
        /*make the matching letters bold:*/
        b.innerHTML = arr[i].category +"<br>"+"<strong>" + arr[i].sub_category.substr(0, val.length) + "</strong>";
        b.innerHTML += arr[i].sub_category.substr(val.length);

        b.setAttribute("data-cat", arr[i].category);
        b.setAttribute("data-sub", arr[i].sub_category);
        b.setAttribute("data-id", arr[i]._id);
        b.setAttribute("data-type", type);


        b.addEventListener("click", function(e) {
            addTag(this.getAttribute("data-cat"),this.getAttribute("data-sub"),this.getAttribute("data-id"), this.getAttribute("data-type"));
        });
        a.appendChild(b);
      }
    }
});

/*execute a function presses a key on the keyboard:*/
inp.addEventListener("keydown", function(e) {
    var x = document.getElementById(this.id + "autocomplete-list");
    if (x) x = x.getElementsByTagName("div");
    if (e.keyCode == 40) {
      /*If the arrow DOWN key is pressed,
      increase the currentFocus variable:*/
      currentFocus++;
      /*and and make the current item more visible:*/
      addActive(x);
    } else if (e.keyCode == 38) { //up
      /*If the arrow UP key is pressed,
      decrease the currentFocus variable:*/
      currentFocus--;
      /*and and make the current item more visible:*/
      addActive(x);
    } else if (e.keyCode == 13) {
      /*If the ENTER key is pressed, prevent the form from being submitted,*/
      e.preventDefault();
      if (currentFocus > -1) {
        /*and simulate a click on the "active" item:*/
        if (x) x[currentFocus].click();
      }
    }
});
function addActive(x) {
  /*a function to classify an item as "active":*/
  if (!x) return false;
  /*start by removing the "active" class on all items:*/
  removeActive(x);
  if (currentFocus >= x.length) currentFocus = 0;
  if (currentFocus < 0) currentFocus = (x.length - 1);
  /*add class "autocomplete-active":*/
  x[currentFocus].classList.add("autocomplete-active");
}
function removeActive(x) {
  /*a function to remove the "active" class from all autocomplete items:*/
  for (var i = 0; i < x.length; i++) {
    x[i].classList.remove("autocomplete-active");
  }
}
function closeAllLists(elmnt) {
  /*close all autocomplete lists in the document,
  except the one passed as an argument:*/
  var x = document.getElementsByClassName("autocomplete-items");
  for (var i = 0; i < x.length; i++) {
    if (elmnt != x[i] && elmnt != inp) {
      x[i].parentNode.removeChild(x[i]);
    }
  }
}

function addTag(cat,sub,id,type) {
  if (type=="interest"){
    var isFound = interestAsTags.find(c => c.categoryID == id);
  } else {
    var isFound = categoriesAsTags.find(c => c.categoryID == id);
  }
  if (!isFound) {
    var tags;
    if (type=="interest"){
      interestAsTags.push({"workCategory":cat, "workSub":sub, "categoryID":id});
      $("#interestSearch").val("");
      tags = $("#searchTags");
    } else {
      categoriesAsTags.push({"workCategory":cat, "workSub":sub, "categoryID":id});
      $("#categorySearch").val("");
      tags = $("#tags");
    }
    var div_col = $("<div>").attr("class","col pink-bg p-2 tag").attr("id",id+"_"+type).appendTo(tags);
    var label = $("<label>").attr("class","red-text").append(cat+" | "+sub).appendTo(div_col);
    var times = $("<span>").attr("class","fa fa-times pointer").attr("onclick","removeTag('"+id+"','"+type+"');").appendTo(label)
  }
  closeAllLists();
}

}

function removeTag(id,type){
  if (type=="interest"){
    interestAsTags = interestAsTags.filter(c => c.categoryID != id);
  } else {
    categoriesAsTags = categoriesAsTags.filter(c => c.categoryID != id);
  }
  $("#"+id+"_"+type).remove();
  console.log(categoriesAsTags);
}


// var countries = [{"category":"Venezuela","sub_category":"Caracas"},{"category":"Venezuela","sub_category":"Cost"}];

var all_categories =  <%- JSON.stringify(categories) %>;
/*initiate the autocomplete function on the "categorySearch" element, and pass along the countries array as possible autocomplete values:*/
autocomplete(document.getElementById("categorySearch"), all_categories, "category");

/*initiate the autocomplete function on the "categorySearch" element, and pass along the countries array as possible autocomplete values:*/
autocomplete(document.getElementById("interestSearch"), all_categories, "interest");
$("#submitBtn").click(function(){

$.post("/client/updateCategories",
    {categories: categoriesAsTags,
    interest: interestAsTags},
    function (data, status) {
        console.log(data)
        console.log(status);
        if (data=="ok")
          $("#steps_process").submit();
      });
})

</script>
