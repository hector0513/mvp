<%- include('partials/requirement/header'); -%>
<head>
<style>

  .unselectable {
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  color: #cc0000;
  }


    .donate-now {
    list-style-type: none;
    margin: 25px 0 0 0;
    padding: 0;
    font-size: 10px;
  }

  .donate-now li {
    float: left;
    margin: 0 5px 0 0;
    width: 100px;
    height: 40px;
    position: relative;
  }

  .donate-now label,
  .donate-now input {
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }

  .donate-now input[type="radio"] {
    opacity: 0.01;
    z-index: 100;
  }

  .donate-now input[type="radio"]:checked+label,
  .Checked+label {
    background: yellow;
  }

  .donate-now label {
    padding: 5px;
    border: 1px solid #CCC;
    cursor: pointer;
    z-index: 90;
  }

  .donate-now label:hover {
    background: #DDD;
  }

</style>

</head>
<body id="page-top" onload="loadChat();">

    <!-- Page Wrapper -->
    <div id="wrapper">

      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

          <!-- Topbar(width>1440px) -->
          <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow breakpoint_navbar">

            <!-- Sidebar Toggle (Topbar) -->


            <!-- Topbar Navbar -->
            <ul class="navbar-nav ml-auto">
              <img class="img-profile" src="/assets/images/logocolorartboard-2.svg" style="width: 15%;">
            </ul>

          <!-- Topbar Search -->


            <div class="dropdown no-arrow rounded-circle mr-3 breakpoint_dropdown">
              <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLinkNav" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-weight:bold;">
                <!-- <i class="fas fa-ellipsis-h fa-sm fa-fw text-blue-400"></i> -->
                Menú
              </a>
              <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in flag" aria-labelledby="dropdownMenuLinkNav" x-placement="bottom-end" style="position: absolute; transform: translate3d(-152px, 18px, 0px); top: 0px; left: 0px; will-change: transform;">
                <div class="sidebar-brand d-flex align-items-center justify-content-center" style="padding: 50px 0 50px 0;">
                  <div style="background-color: blue;width: 35px;height: 35px;border-radius: 42px; margin-right: 12px;">
                    <div class="col-md-2">
                      <img src="/assets/images/Client/notification.svg" class="card-img" alt="..." style="width: auto; background-color: blue; height: auto;position: relative;top: 0;bottom: 0;margin: auto; margin-left: -1px;margin-top: 8px;border-radius: 15px;">
                    </div>
                  </div>
                  <div style="background-color: blue;width: 35px;height: 35px;border-radius: 42px; margin-right: 40px;">
                    <div class="col-md-2">
                      <img src="/assets/images/Client/settings.svg" class="card-img" alt="..." style="width: auto; background-color: blue; height: auto;position: relative;top: 0;bottom: 0;margin: auto; margin-left: -3px;margin-top: 8px;border-radius: 15px;" data-toggle="modal" data-target="#smallModal" type="button">
                    </div>
                  </div>
                  <a href="/client/profile" style="font-family: Quicksand; font-weight: bold; font-stretch: normal; font-style: normal; line-height: 1.33; color: #2a2a35; margin-right: 10px; text-decoration: none; margin-top: -20px;"><%= user.firstname %> <%= user.lastname %></a>
                  <a href="/client/profile"><img class="img-profile rounded-circle" src="<%= user.photo %>" style="width: 60px; height: 60px; object-fit: cover;"></a>
                </div>
              </div>
            </div>
          </nav>

          <!-- small modal for settings -->
        <div class="modal fade" id="smallModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Configuración</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            <div class="modal-body">
              <a class="btn btn-block btn-primary px-4 label_style2 steps1" data-dismiss="" style="width: auto;" href="/client/profile">Ver perfil</a>
              <a class="btn btn-block btn-primary px-4 label_style2 steps1" data-dismiss="" style="width: auto;" href="/login/logout">Cerrar sesión</a>
            </div>
            </div>
          </div>
        </div>

          <!-- End of Topbar -->

          <!-- Topbar(width<1440px) -->
          <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 fixed-top shadow breakpoint_navbar2">

            <!-- Sidebar Toggle (Topbar) -->


            <!-- Topbar Navbar -->
            <ul class="navbar-nav ml-auto">
              <img class="img-profile" src="/assets/images/logocolorartboard-2.svg" style="width: 15%;">
            </ul>

          <!-- Topbar Search -->

            <div class="dropdown no-arrow rounded-circle mr-3 breakpoint_dropdown position-static">
              <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLinkNav" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-weight:bold;">
                <!-- <i class="fas fa-ellipsis-h fa-sm fa-fw text-blue-400"></i> -->
                Menú
              </a>
              <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in flag w-100 text-center" aria-labelledby="dropdownMenuLinkNav" x-placement="bottom-end" style="position: absolute; transform: translate3d(-152px, 18px, 0px); top: 0px; left: 0px; will-change: transform;">
                <div class="sidebar-brand d-flex align-items-center justify-content-center" style="padding: 25px 0 15px 0;">
                  <div style="background-color: blue;width: 35px;height: 35px;border-radius: 42px; margin-right: 12px;">
                    <div class="col-md-2">
                      <img src="/assets/images/Client/notification.svg" class="card-img" alt="..." style="width: auto; background-color: blue; height: auto;position: relative;top: 0;bottom: 0;margin: auto; margin-left: -1px;margin-top: 8px;border-radius: 15px;">
                    </div>
                  </div>
                  <div style="background-color: blue;width: 35px;height: 35px;border-radius: 42px; margin-right: 40px;">
                    <div class="col-md-2">
                      <img src="/assets/images/Client/settings.svg" class="card-img" alt="..." style="width: auto; background-color: blue; height: auto;position: relative;top: 0;bottom: 0;margin: auto; margin-left: -3px;margin-top: 8px;border-radius: 15px;" data-toggle="modal" data-target="#smallModal" type="button">
                    </div>
                  </div>
                  <a href="/client/profile" style="font-family: Quicksand; font-weight: bold; font-stretch: normal; font-style: normal; line-height: 1.33; color: #2a2a35; margin-right: 10px; text-decoration: none; margin-top: -20px;"><%= user.firstname %> <%= user.lastname %></a>
                  <a href="/client/profile"><img class="img-profile rounded-circle" src="<%= user.photo %>" style="width: 60px; height: 60px; object-fit: cover;"></a>
                </div>
                <div class="dropdown-divider"></div>
                <li class="nav-item active d-flex align-items-center justify-content-center">
                  <button class="btn btn-outline-primary style_btn" style="border-radius: 10px;" id="workerBtn1">Ir a Perfil de Socio</button>
                </li>
                <div class="dropdown-divider"></div>
                <div class="h5 mb-0" style="color: black">
                  Información
                </div>
                <div class="dropdown-divider"></div>
                <div class="card mb-3 style_border" style="max-width: 335px; margin: 0 auto; padding: 0;">
                  <div class="row no-gutters">
                    <div class="col-md-2">
                      <img src="/assets/images/Client/diamond.svg" class="card-img" alt="..." style="width: 51%; background-color: blue; height: 70%;position: absolute;top: 0;bottom: 0;margin: auto;border-radius: 15px;">
                    </div>
                    <div class="col-md-10">
                      <div class="card-body" style="padding: 15px 0 5px 0;">
                        <h5 class="card-title text-center" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: normal; letter-spacing: normal; color: #2a2a35; font-size: 14px; ">Tienes 0 pagos pendientes</h5>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="dropdown-divider"></div>
                <div class="card mb-3 style_border" style="max-width: 335px; margin: 0 auto; padding: 0;">
                  <div class="row no-gutters">
                    <div class="col-md-2">
                      <img src="/assets/images/Client/growth.svg" class="card-img" alt="..." style="width: 51%; background-color: blue; height: 70%;position: absolute;top: 0;bottom: 0;margin: auto;border-radius: 15px;">
                    </div>
                    <div class="col-md-10">
                      <div class="card-body" style="padding: 15px 0 5px 0;">
                        <h5 class="card-title text-center" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: normal; letter-spacing: normal; color: #2a2a35; font-size: 14px; ">Desempeño de referidos: 0/10
                          </h5>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="dropdown-divider"></div>
                <div class="card shadow mb-4" style="margin: 0 auto; max-width: 335px; display: none;">
                  <!-- Card Header - Dropdown -->
                  <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary" style="font-size: 14px; color: #2a2a35 !important;">Tu socio favorito</h6>
                    <div class="dropdown no-arrow">
                      <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLinkpartner" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-ellipsis-h fa-sm fa-fw text-blue-400"></i>
                      </a>
                      <!-- <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                    <div class="dropdown-header">Reportar:</div>
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                  </div> -->
                    </div>
                  </div>
                  <!-- Card Body -->
                  <div class="card mb-3" style="max-width: 450px; padding: 0; box-shadow: none !important;">
                    <div class="row no-gutters" style="margin-top: 10px;">
                      <div class="col-md-4">
                        <img src="https://source.unsplash.com/QAB-WJcbgJk/60x60" class="card-img" alt="..." style="width: auto; height: auto;position: relative;top: 0;bottom: 0;margin: auto;">
                      </div>
                      <div class="col-md-8">
                        <div class="card-body" style="padding: 15px 0 5px 0;">
                          <h5 class="card-title text-center" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: normal; letter-spacing: normal; color: #2a2a35; font-size: 14px; ">Eduardo Florez</h5>
                          <p class="card-text text-center" style="font-weight: normal; font-stretch: normal; font-style: normal; line-height: normal; letter-spacing: normal; color: #2a2a35; font-size: 14px;">4 requerimientos completados</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="dropdown-divider"></div>
                <div class="card shadow mb-4" style="margin: 85px auto 0 auto; background-color: #f4f4ff; box-shadow: -10px -10px 20px 0 #e0e0ff, 10px 10px 20px 0 #ffffff; max-width: 335px;">
                  <!-- Card Header - Dropdown -->
                  <div class="card-header py-3 d-flex flex-row align-items-center justify-content-center" style="background-color: transparent;">
                    <img src="/assets/images/Client/group-8.svg" alt="..." style="margin-top: -120px;">
                  </div>
                  <!-- Card Body -->
                  <div class="card-body text-center">
                    <h6 class="m-0 font-weight-bold text-primary text-center" style="margin-top: 50px !important; color: #2a2a35 !important">Mi calificación</h6>
                    <p class="card-text text-center" style="font-weight: lighter; font-stretch: normal; font-style: normal; line-height: 1.14; letter-spacing: normal; color: #2a2a35; margin-top: 10px;">Desempeño como cliente</p>
                    <h6 class="m-0 font-weight-bold text-primary text-center" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: 1.14; letter-spacing: normal; color: #009270 !important; margin-top: 50px !important; font-size: 25px;">0 de 5</h6>
                    <a href="/">Ver calificaciones</a>
                  </div>
                </div>
              </div>
            </div>
          </nav>

          <!-- End of Topbar -->
          <!-- Begin Page Content -->
        <div class="container-fluid">

            <!-- Page Heading -->
            <div class="d-sm-flex align-items-center justify-content-between mb-4" style="margin: 50px 0 0px 0;">
                <a class="fas fa-arrow-left" style="width: auto !important;" href="/client"><p style="font-family: Quicksand; display: inline-block;">&nbsp&nbsp Volver a inicio </p></a></div>

              <!-- modal for wallet -->
              <div class="modal fade" id="Modal-wallet" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content" style="border-radius: 42px; padding: 35px;">
                      <div class="modal-header" style="margin: 0 auto;">
                        <h4 class="modal-title" id="myModalLabel" style="font-weight: bold; color:#4444ff">Pago del requerimiento</h4>
                      </div>
                      <div class="row">
                        <div class="col-8">
                          Servicios Profecionales(40%)
                        </div>
                        <div class="col-4" id="payment">
                        </div>
                      </div>
                      <hr>
                      <div class="row">
                        <div class="col-8">
                          Total
                        </div>
                        <div class="col-4" id="total">
                        </div>
                      </div>
                      <br>

                      <button id="wallet" class="asilinks-btn orange-btn" onclick="acceptWallet('<%= requirement.proposal._id %>')">Pagar con Wallet</button>
                    <div class="modal-body">
                      <div class="card-body">
                      <form enctype="multipart/form-data">
                        <fieldset>

                          <div class="form-group row">
                            <div class="col-sm-12">
                                <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">CORREO</label>
                                <input type="text" class="form-control" id="email" placeholder="" style="color: #2a2a35" required="true">
                            </div>
                        </div>
                        <div class="form-group row">
                          <div class="col-sm-12">
                              <label for="title" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">NUMERO DE TARJETA</label>
                              <input type="text" class="form-control" id="card_number" placeholder="" style="color: #2a2a35" required="true">
                          </div>
                        </div>
                          <div class="form-group row">
                              <div class="col-sm-6 delete_after">
                                  <label for="category" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">VENCIMIENTO</label>
                                  <span class="expiration">
                                    <input type="text" class="form-control" style="color: #2a2a35" id="expiration_month" name="month" placeholder="MM" maxlength="2" size="2" required="true" />
                                    <span>/</span>
                                    <input type="text" class="form-control" style="color: #2a2a35" id="expiration_year" name="year" placeholder="YYYY" maxlength="4" size="4" required="true" />
                                </span>
                              </div>
                              <div class="col-sm-6 delete_after">
                                  <label for="subcategory" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">CVV</label>
                                  <input type="text" class="form-control" id="cvv" placeholder="" style="color: #2a2a35" required="true"/>
                              </div>
                          </div>
                          <div class="form-group row">
                              <div class="col-sm-12">
                                  <label for="description" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">NOMBRE DE LA TARJETA</label>
                                  <input type="text" class="form-control" id="nameCard" placeholder="" style="color: #2a2a35" required="true">
                              </div>
                          </div>
                          <div class="form-group row">
                            <div class="col-sm-12">
                                <label for="description" style="font-family: Quicksand; font-weight: bold; color: #bcbcca;">PAIS O REGIÓN</label>
                                <input type="text" class="form-control" id="country" placeholder="" style="color: #2a2a35" required="true">
                            </div>
                        </div>
                          </fieldset>
                        </form>
                        <button id="pay" class="asilinks-btn orange-btn" onclick="accept('<%= requirement.proposal._id %>');">
                          Pagar
                        </button>
                    </div>
                    </div>
                    </div>
                  </div>

                </div>
                <!-- end of modal -->


                <!-- modal for receipt -->
                <div class="modal fade" id="Modal-receipt" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                      <div class="modal-content" style="border-radius: 42px; padding: 35px;">
                        <div class="modal-header" style="margin: 0 auto;">
                          <h4 class="modal-title" id="myModalLabel" style="font-weight: bold; color:#4444ff">Recibo de pago</h4>
                        </div>

                        <br>
                          <div class="modal-body">
                        <div class="card-body">
                          <div class="row" style="z-index:2;">
                            <div class="col-12" align="center">
                              <img src="/assets/images/check.png">
                            </div>
                          </div>
                          <p><br></p>
                          <div class="row" align="center" style="margin-top:-5vw;z-index:0;">
                            <div id="html_services"class="col-12" style="
                            border-radius: 10px;
                            border: solid 1px #bcbcca;">
                            </div>
                          </div>
                          <div class="row" align="right">
                            <div class="col-6"></div>
                            <div class="col-6" align="right">
                              <button id="pdfService" onclick="download('services');" class="btn btn-block btn-primary px-4 label_style2" style="border-radius: 10px;
                              background-image: linear-gradient(to right, #1d1dff, #5757ff);
                              font-family: Quicksand;
                              font-weight: bold;
                              font-stretch: normal;
                              font-style: normal;
                              color: #ffffff;
                              ">
                                Descargar PDF
                              </button>
                            </div>
                          </div>
                      </div>
                      </div>
                      </div>
                    </div>

                  </div>
                  <!-- end of modal -->

              <!-- modal for preview -->
              <div class="modal fade" id="Modal-preview" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content" style="border-radius: 42px; padding: 35px;">
                      <div class="modal-header" style="margin: 0 auto;">
                        <h4 class="modal-title" id="myModalLabel" style="font-weight: bold; color:#4444ff">Preview</h4>
                      </div>

                      <hr>
                      <embed src="<%= requirement.file %>" class="unselectable" type="application/pdf" frameborder="0" width="100%" />

                      <br>
                        <div class="modal-body">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-6">
                          </div>
                          <div class="col-6">
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-6">
                            <button id="reject" onclick="reject('<%= requirement._id %>');"  data-toggle="modal" data-target="#Modal-reject"  class="btn btn-block btn-primary px-4 label_style2" style="font-weight: normal; width: 100%; margin-top: 50px; ">
                              Rechazar
                            </button>
                          </div>
                          <div class="col-6">
                            <% if(requirement.paymentDone) { %>

                              <button id="files_att" onclick="downloadAll();" class="btn btn-block btn-primary px-4 label_style2" style="font-weight: normal; width: 100%; margin-top: 50px; ">
                                Descargar Archivos
                              </button>

                              <% } else { %>
                            <button id="pay" onclick="updateModal('<%= requirement.proposal.price %>', '<%= user.wallet %>','Modal-preview');" data-toggle="modal"  data-target="#Modal-wallet"  class="btn btn-block btn-primary px-4 label_style2" style="font-weight: normal; width: 100%; margin-top: 50px; ">
                              Descargar Archivos
                            </button>

                            <% } %>
                          </div>
                        </div>
                    </div>
                    </div>
                    </div>
                  </div>

                </div>
                <!-- end of modal -->


                <!-- modal for reject -->
                <div class="modal fade" id="Modal-reject" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                      <div class="modal-content" style="border-radius: 42px; padding: 35px;">
                        <div class="modal-header" style="margin: 0 auto;">
                          <h4 class="modal-title" id="myModalLabel" style="font-weight: bold; color:#4444ff">Rechazar Entrega</h4>
                        </div>

                          <div class="modal-body">
                        <div class="card-body">
                          <div class="row">
                            <div class="col-12">
                              <h6> ¿Deseas rechazar esta entrega?</h6>
                            </div>
                          </div>

                          <% if (!requirement.proposal.extension.requested) { %>
                          <div class="row">
                            <div class="col-6">
                              <button id="rejectWork" onclick="rejectWork('<%= requirement._id %>');" class="btn btn-block btn-primary px-4 label_style2" style="font-weight: normal; width: 100%; margin-top: 50px; ">
                                Rechazar
                              </button>
                            </div>
                            <div class="col-6">
                              <button id="extend" onclick="extendWork('<%= requirement._id %>');" class="btn btn-block btn-primary px-4 label_style2" style="font-weight: normal; width: 100%; margin-top: 50px; ">
                                Extender la entrega
                              </button>
                            </div>
                          </div>

                          <%} else {%>

                            <div class="row">
                              <div class="col-12">
                                <button onclick="rejectWork('<%= requirement._id %>');" class="btn btn-block btn-primary px-4 label_style2" style="font-weight: normal; width: 100%; margin-top: 50px; ">
                                  Rechazar
                                </button>
                              </div>
                            </div>
                          <%}%>
                      </div>
                      </div>
                      </div>
                    </div>

                  </div>
                  <!-- end of modal -->



                              <!-- modal for rate -->
                              <div class="modal fade" id="Modal-ratePartner" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
                                  <div class="modal-dialog modal-xl modal-dialog-centered">
                                    <div class="modal-content" style="border-radius: 42px; padding: 35px;">
                                      <div class="modal-header" style="margin: 0 auto;">
                                        <h4 class="modal-title" id="myModalLabel" style="font-weight: bold; color:#4444ff">Felicidades!</h4>
                                      </div>

                                          <br>
                                        <div class="modal-body">
                                      <div class="card-body">
                                        <div class="row">
                                          <div id="desc"class="col-12">
                                              <p>
                                                Hemos recibido tu pago con éxito. <br><br>Ya puedes pasar a descargar los entregables de <%= partner.firstname %> y antes quisieramos pedirte un último favor de que comentes cómo fue tu experiencia trabajando con <%= partner.firstname %>. Siempre en pro de mejorar y seguirte brindando la mejor experiencia.
                                                <br><br>¡Para nosotros es muy valiosa tu opinión! ¡Muchas gracias!
                                                <br>
                                                <br>

                                                <a href="/partner/profile"><img class="img-profile rounded-circle" src="<%= partner.photo %>" style="width: 60px; height: 60px; object-fit: cover;"></a>
                                              <a href="/partner/profile" style="font-family: Quicksand; font-weight: bold; font-stretch: normal; font-style: normal; line-height: 1.33; color: #2a2a35; margin-right: 10px; text-decoration: none; margin-top: -20px;"><%= partner.firstname %> <%= partner.lastname %></a>
                                            </p>
                                          </div>
                                        </div>
                                        <form action="/client/ratePartner/<%= partner._id%>" enctype="application/form-data" method="post" >
                                        <div class="row">
                                          <div class="col-12">

                                            <section
                                              class="radio_requeriments2"
                                              id="tabs3-3"
                                              style=""
                                            >
                                              <label>
                                                <input
                                                  type="radio"
                                                  name="rate"
                                                  value="Muy Deficiente"
                                                  id="radio000"
                                                />
                                                <div class="btn_nav3 btn-sik3">
                                                  <span>Muy Deficiente</span>
                                                </div>
                                              </label>
                                              <label>
                                                <input
                                                  type="radio"
                                                  name="rate"
                                                  value="Deficiente"
                                                  id="radio111"
                                                />
                                                <div class="btn_nav3 btn-sik3">
                                                  <span>Deficiente</span>
                                                </div>
                                              </label>
                                              <label>
                                                <input
                                                  type="radio"
                                                  name="rate"
                                                  value="Normal"
                                                  id="radio222"
                                                />
                                                <div class="btn_nav3 btn-sik3">
                                                  <span>Normal</span>
                                                </div>
                                              </label>
                                              <label>
                                                <input
                                                  type="radio"
                                                  name="rate"
                                                  value="Buena"
                                                  id="radio333"
                                                />
                                                <div class="btn_nav3 btn-sik3">
                                                  <span>Buena</span>
                                                </div>
                                              </label>
                                              <label>
                                                <input
                                                  type="radio"
                                                  name="rate"
                                                  value="Muy Buena"
                                                  id="radio444"
                                                />
                                                <div class="btn_nav3 btn-sik3">
                                                  <span>Muy Buena</span>
                                                </div>
                                              </label>
                                            </section>

                                              <input type="text" name="requirement" value="<%= requirement._id%>" hidden/>
                                              <br>
                                              <p> COMENTARIO </p>

                                              <textarea  type="text" class="form-control" name="comment" style="border:0;" ></textarea>
                                            <button type="submit" class="btn btn-block btn-primary px-4 label_style2" style="font-weight: normal; width: 100%; margin-top: 50px; ">
                                              Enviar calificación
                                            </button>
                                          </div>
                                        </div>
                                      </form>
                                    </div>
                                    </div>
                                    </div>
                                  </div>

                                </div>



            <!-- Content Row -->
            <div class="row">
                <div class="col-xl col-lg">
                    <div class="card shadow mb-4">
                      <!-- Card Body -->
                      <div class="card-body">
                        <div class="row no-gutters">
                          <div class="col">
                            <img src="https://picsum.photos/500.webp" class="card-img rounded2" alt="..." style="width: 50%; height: 100%;">
                          </div>
                          <div class="col-md-8 col-8 col-sm-8">
                            <div class="card-body" style="padding: 1.25rem !important;">
                              <h5 class="card-title breakpoint_font" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: 1.43; letter-spacing: normal; color: #2a2a35;"><%= requirement.name %></h5>
                              <p class="card-text" style="font-weight: normal; font-stretch: normal; font-style: normal; line-height: 1.14; letter-spacing: normal; color: #2a2a35;">Por <%= user.firstname %> <%= user.lastname %></p>
                              <a href="" class="btn btn-outline-primary style_btn" style="font-size: .7rem;"><%= requirement.category_name %></a>
                              <a href="" class="btn btn-outline-primary style_btn" style="font-size: .7rem;"><%= requirement.subcategory_name %></a>
                            </div>
                          </div>
                        </div>
                        <br><br>
                        <h6 class="col" style="font-weight: bold; color: #2a2a35;">Descripión</h6>
                        <p class="col"><%= requirement.description %></p>
                        <ul id="progressbar" style="margin: 0; padding: 0; list-style:none;" class="col">
                            <li style="margin: 20px 0; "><a class="fas fa-check user_style" style="display: inline list-item;"><p style="font-family: Quicksand; display: inline-block; color: #2a2a35;">&nbsp;&nbsp; Propuesta aceptada el: </p><p style="font-family: Quicksand; display: inline-block; color: #2a2a35; font-weight: normal;">&nbsp;<%= moment(requirement.proposal.acceptedTime).format("DD/MM/YYYY") %></p></a></li>
                            <li style="margin: 20px 0;"><a class="fas fa-briefcase user_style" style="display: inline;"><p style="font-family: Quicksand; display: inline-block; color: #2a2a35;">&nbsp;&nbsp; Tiempo de trabajo: </p><p style="font-family: Quicksand; display: inline-block; color: #2a2a35; font-weight: normal;">&nbsp;<%= requirement.proposal.estimatedTime %> <%= requirement.proposal.estimatedUnit %></p></a></li>
                            <li style="margin: 20px 0; "><a class="fas fa-calendar-alt user_style" style="display: inline list-item;"><p style="font-family: Quicksand; display: inline-block; color: #2a2a35;">&nbsp;&nbsp; Fecha de entrega estimada: </p><p style="font-family: Quicksand; display: inline-block; color: #2a2a35; font-weight: normal;">&nbsp;<%= moment(requirement.proposal.deadline).format("DD/MM/YYYY") %> </p></a></li>
                            <li style="margin: 20px 0; "><a class="fas fa-money-bill-wave user_style" style="display: inline list-item;"><p style="font-family: Quicksand; display: inline-block; color: #2a2a35;">&nbsp;&nbsp; Precio: </p><p style="font-family: Quicksand; display: inline-block; color: #2a2a35; font-weight: normal;">&nbsp;$<%= requirement.proposal.price %> </p></a></li>
                          </ul>
                          <% if (requirement.file) {%>
                              <h6 class="col" style="font-weight: bold; color: #2a2a35;">Adjuntos</h6>

                              <% if (requirement.paymentDone) {%>
                                <a href='<%= requirement.file %>' class="col file" style="" download='<%= requirement.fileName %>'><%= requirement.fileName %></a><br>
                                <% for (var f=0; f<requirement.otherFiles.length; f++) {%>
                                  <a href='<%= requirement.otherFiles[f].filePath %>' class="col file"  style="" download='<%= requirement.otherFiles[f].fileName %>'><%= requirement.otherFiles[f].fileName %></a><br>
                                <% } %>
                              <% } else { %>
                                <a href="" class="col"style=""><%= requirement.fileName %></a>
                              <% } %>
                                <h6 class="col" style="font-weight: bold; color: #2a2a35;">Comentario</h6>
                                <p class="col" style="color: #2a2a35;"><%= requirement.fileComment %></p>

                          <% } %>
                        <button data-toggle="modal" data-target="#Modal-preview" class="btn btn-block btn-primary px-4 label_style2" style="font-weight: normal; width: 100%; margin-top: 50px; ">Ver entregable</button>
                      </div>
                    </div>
                  </div>



                  <div class="col-xl col-lg">
                    <div class="card shadow mb-4" style="padding: 0;">
                      <!-- Card Body -->
                      <div class="card-body" style="padding: 0;">
                        <div class="col" style="padding: 0;">
                            <div class="settings-tray">
                                <div class="friend-drawer no-gutters friend-drawer--grey">
                                <img class="profile-image" src="<%= partner.photo %>" onerror = 'this.src="https://st4.depositphotos.com/1000507/24026/v/450/depositphotos_240260608-stock-illustration-robocop-simple-abstract-vector-illustration.jpg"' alt="">
                                <div class="text">
                                  <h6><%= partner.firstname %> <%= partner.lastname%></h6>
                                  <p id="lastLogin" class="text-muted">
                                    <% if (partner.lastLogin){ %>
                                        <%= moment(partner.lastLogin).format("DD/MM/YYYY hh:mm a") %>
                                    <%} else {%>
                                        Offline
                                    <%}%>
                                  </p>
                                </div>
                              </div>
                            </div>
                            <hr style="margin: 0 auto;">
                            <div class="text-center">
                            <!-- <button class="btn btn-info" style="  border-radius: 18px; background-color: #f4f4ff; border: #f4f4ff; color: #000; font-weight: lighter;">AYER</button> -->
                            </div>
                            <div class="chat-panel" style="max-height: 50vh;overflow-y: scroll;" id="chat_panel">
                              <!-- <div class="row no-gutters">
                                <div class="col-md-9 col-sm-9 col-9">
                                  <div class="chat-bubble chat-bubble--left">
                                    Hello dude!
                                    <p style="float: right; font-size: 10px; margin-top: 15px; color: #8f8f8f;">4:49 PM</p>
                                  </div>
                                </div>
                              </div>
                              <div class="row no-gutters">
                                <div class="col-md offset-md-3 offset-sm-3 offset-3">
                                  <div class="chat-bubble chat-bubble--right">
                                    Hello dude!
                                    <p style="float: right; font-size: 10px; margin-top: 15px; color: #4444ff;">4:49 PM</p>
                                  </div>
                                </div>
                              </div> -->
                            </div>
                            <div class="row">
                              <div class="col-12">
                                <div class="chat-box-tray">
                                  <!-- <i class="fas fa-paperclip"></i> -->
                                  <input id="chat_message" type="text" placeholder="Escribe tu mensaje…" >
                                  <i id="send_message" class="fas fa-paper-plane" onclick="sendMessage()"></i>
                                </div>
                              </div>
                            </div>
                          </div>
                      </div>
                    </div>
                  </div>
            </div>

    </div>
  <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Copyright &copy; Asilinks 2020</span>
            </div>
          </div>
        </footer>
        <!-- End of Footer -->

      </div>
      <!-- End of Content Wrapper -->

      <!-- Sidebar -->
      <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion style_sidebar" id="accordionSidebar">

        <!-- Sidebar - Brand -->
        <div class="sidebar-brand d-flex align-items-center justify-content-center" style="padding: 50px 0 50px 0;">
          <div style="background-color: blue;width: 35px;height: 35px;border-radius: 42px; margin-right: 12px;">
            <div class="col-md-2">
              <img src="/assets/images/Client/notification.svg" class="card-img" alt="..." style="width: auto; background-color: blue; height: auto;position: relative;top: 0;bottom: 0;margin: auto; margin-left: -1px;margin-top: 8px;border-radius: 15px;">
            </div>
          </div>
          <div style="background-color: blue;width: 35px;height: 35px;border-radius: 42px; margin-right: 40px;">
            <div class="col-md-2">
              <img src="/assets/images/Client/settings.svg" class="card-img" alt="..." style="width: auto; background-color: blue; height: auto;position: relative;top: 0;bottom: 0;margin: auto; margin-left: -3px;margin-top: 8px;border-radius: 15px;" data-toggle="modal" data-target="#smallModal" type="button">
            </div>
          </div>
          <a href="/client/profile" style="font-family: Quicksand; font-weight: bold; font-stretch: normal; font-style: normal; line-height: 1.33; color: #2a2a35; margin-right: 10px; text-decoration: none; margin-top: -20px;"><%= user.firstname %> <%= user.lastname %></a>
          <a href="/client/profile"><img class="img-profile rounded-circle" src="<%= user.photo %>" style="width: 60px; height: 60px; object-fit: cover;"></a>
        </div>

        <!-- Nav Item - Dashboard -->
        <li class="nav-item active d-flex align-items-center justify-content-center">
            <button class="btn btn-outline-primary style_btn" style="border-radius: 10px;" id="workerBtn2">Ir a Perfil de Socio</button>
        </li>

        <!-- Divider -->
        <hr>

        <!-- Heading -->
        <div class="h5 mb-0" style="margin-left: 20px; color: black">
          Información
        </div>

        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
          <div class="card mb-3 style_border" style="max-width: 450px; margin: 40px 40px 10px 40px; padding: 0;">
            <div class="row no-gutters">
              <div class="col-md-4">
                <img src="/assets/images/Client/diamond.svg" class="card-img" alt="..." style="width: 51%; background-color: blue; height: 70%;position: absolute;top: 0;bottom: 0;margin: auto;margin-left: 10px;border-radius: 15px;">
              </div>
              <div class="col-md-8">
                <div class="card-body" style="padding: 15px 0 5px 0;">
                  <h5 class="card-title text-center" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: normal; letter-spacing: normal; color: #2a2a35; font-size: 14px; ">Tienes 0 pagos pendientes</h5>
                </div>
              </div>
            </div>
          </div>
        </li>

        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
          <div class="card mb-3 style_border" style="max-width: 450px; margin: 10px 40px 10px 40px; padding: 0;">
            <div class="row no-gutters">
              <div class="col-md-4">
                <img src="/assets/images/Client/growth.svg" class="card-img" alt="..." style="width: 51%; background-color: blue; height: 70%;position: absolute;top: 0;bottom: 0;margin: auto;margin-left: 10px;border-radius: 15px;">
              </div>
              <div class="col-md-8">
                <div class="card-body" style="padding: 15px 0 5px 0;">
                  <h5 class="card-title text-center" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: normal; letter-spacing: normal; color: #2a2a35; font-size: 14px; ">Desempeño de referidos 0/10</h5>
                </div>
              </div>
            </div>
          </div>
        </li>

        <!-- Nav Item - Utilities Collapse Menu -->
        <li class="nav-item">
          <div class="card shadow mb-4" style="margin: 10px 40px 10px 40px; display: none;">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
              <h6 class="m-0 font-weight-bold text-primary" style="font-size: 14px; color: #2a2a35 !important;">Tu socio favorito</h6>
              <div class="dropdown no-arrow">
                <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLinkpartner" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fas fa-ellipsis-h fa-sm fa-fw text-blue-400"></i>
                </a>
                <!-- <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                    <div class="dropdown-header">Reportar:</div>
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                  </div> -->
              </div>
            </div>
            <!-- Card Body -->
            <div class="card mb-3" style="max-width: 450px; padding: 0; box-shadow: none !important;">
              <div class="row no-gutters" style="margin-top: 10px;">
                <div class="col-md-4">
                  <img src="https://source.unsplash.com/QAB-WJcbgJk/60x60" class="card-img" alt="..." style="width: auto; height: auto;position: absolute;top: 0;bottom: 0;margin: auto;">
                </div>
                <div class="col-md-8">
                  <div class="card-body" style="padding: 15px 0 5px 0;">
                    <h5 class="card-title text-left" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: normal; letter-spacing: normal; color: #2a2a35; font-size: 14px; ">Eduardo Florez</h5>
                    <p class="card-text text-left" style="font-weight: normal; font-stretch: normal; font-style: normal; line-height: normal; letter-spacing: normal; color: #2a2a35; font-size: 14px;">4 requerimientos completados</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </li>

        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
          <div class="card shadow mb-4" style="margin: 100px 40px 10px 40px; background-color: #f4f4ff; box-shadow: -10px -10px 20px 0 #e0e0ff, 10px 10px 20px 0 #ffffff;">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-center" style="background-color: transparent;">
              <img src="/assets/images/Client/group-8.svg" alt="..." style="margin-top: -120px;">
            </div>
            <!-- Card Body -->
            <div class="card-body text-center">
              <h6 class="m-0 font-weight-bold text-primary text-center" style="margin-top: 50px !important; color: #2a2a35 !important">Mi calificación</h6>
              <p class="card-text text-center" style="font-weight: lighter; font-stretch: normal; font-style: normal; line-height: 1.14; letter-spacing: normal; color: #2a2a35; margin-top: 10px;">Desempeño como cliente</p>
              <h6 class="m-0 font-weight-bold text-primary text-center" style="font-weight: bold; font-stretch: normal; font-style: normal; line-height: 1.14; letter-spacing: normal; color: #009270 !important; margin-top: 50px !important; font-size: 25px;">0 de 5</h6>
              <a href="/">Ver calificaciones</a>
            </div>
          </div>
        </li>

<%- include('partials/requirement/sub-footer'); -%>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous"></script>

<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
  var proposal;

  function updateModal(price, wallet, modal){
    $('#Modal-preview').modal('hide');
    var fee = price * 0.1 // 10% fee
    var partner_payment = price*0.4 // 60% to partner
    var ammount = partner_payment;
    $("#payment").html(partner_payment.toFixed(2));
    $("#fee").html(fee.toFixed(2));
    $("#total").html(ammount.toFixed(2));
    if (wallet<ammount){
      $("#wallet").prop('disabled', true);
    } else {
      $("#wallet").prop('disabled', false);
    }
  }

  function reject(requirement){
    $('#Modal-preview').modal('hide');
  }
  function rejectWork(requirement){

    var reqInfo = {
      requirement
    }

    $.post("/opportunity/rejectWork",
      reqInfo,
      function(data,status){
          console.log(data)
          console.log(status);
          if (data=="ok") window.location.reload();
      });
  }
  function extendWork(requirement){

    var reqInfo = {
      requirement
    }

    $.post("/opportunity/extendWork",
      reqInfo,
      function(data,status){
          console.log(data)
          console.log(status);
          if (data=="ok") window.location.reload();
          else alert(data)
      });
  }

  function accept(proposal){

    var reqInfo = {
      creditCardNumber: $("#card_number").val(),
      expiration_month: $("#expiration_month").val(),
      expiration_year: $("#expiration_year").val(),
      cvv: $("#cvv").val(),
      nameCard: $("#nameCard").val(),
      country: $("#country").val(),
      proposal
    }

    $.post("/opportunity/inProgress/cardPayment",
      reqInfo,
      function(data,status){
        if (status=="success"){
          $('#Modal-wallet').modal('hide');
          $('#Modal-receipt').modal('show');
          $("#html_fee").html(data.html_fee);
          $("#html_services").html(data.html_services);
          html_fee=data.html_fee;
          html_services=data.html_services;
        } else {
          alert("Error at payment");
        }
      });
  }

  function acceptWallet(proposal){

    var reqInfo = {
      proposal
    }

    $.post("/opportunity/inProgress/walletPayment",
      reqInfo,
      function(data,status){
          console.log(data)
          console.log(status);
          if (status=="success"){
            $('#Modal-wallet').modal('hide');
            $('#Modal-receipt').modal('show');
            $("#html_fee").html(data.html_fee);
            $("#html_services").html(data.html_services);
            html_fee=data.html_fee;
            html_services=data.html_services;
            // hideModal('Modal-wallet');
            // $("#ratePartner").click()
          } else {
            alert("Error at payment");
          }
      });
  }

  function download(type){
    var receipt = $("#html_services").html();

  var doc = new jsPDF();
  var elementHandler = {
      '.download-btn': function (element, renderer) {
          return true;
      }
  };

  doc.fromHTML(
      receipt,
      15,
      15,
      {
          'width': 180,'elementHandlers': elementHandler
      }
  );

  doc.save("receipt_"+type+".pdf");

  }
  $('#Modal-receipt').on('hidden.bs.modal', function () {
     $('#Modal-ratePartner').modal('show');
  })


function hideModal(modal){
  $('#'+modal).modal('hide');
}

const socket = io()

socket.on('private-message', (data) => {
     if (data.message != ""){
     var div_row = $("<div>").attr("class","row no-gutters").appendTo('#chat_panel');
       if (data.me){
         var div_col = $("<div>").attr("class","col-md offset-md-3 offset-sm-3 offset-3").appendTo(div_row);
         var div_chat = $("<div>").attr("class","chat-bubble chat-bubble--right").append(data.message).appendTo(div_col);
           var p_text = $("<p>").attr("style","float: right; font-size: 10px; margin-top: 15px; color: #8f8f8f;").append(data.time).appendTo(div_chat);
       } else {
         var div_col = $("<div>").attr("class","col-md-9 col-sm-9 col-9").appendTo(div_row);
         var div_chat = $("<div>").attr("class","chat-bubble chat-bubble--left").append(data.message).appendTo(div_col);
          var p_text = $("<p>").attr("style","float: right; font-size: 10px; margin-top: 15px; color: #4444ff;").append(data.time).appendTo(div_chat);
       }
       $("#lastLogin").html(data.lastLogin);
     }
     scrollSmoothToBottom()
})

socket.on('chat_disconnect', (data) => {
    $("#lastLogin").html(data.lastLogin);
})



// Execute a function when the user releases a key on the keyboard
$('#chat_message').on("keyup", function(event) {
  // Number 13 is the "Enter" key on the keyboard
  if (event.keyCode === 13) {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    $("#send_message").click();
  }
});

function sendMessage(){
  var message = $('#chat_message').val();
  var data = {
    message,
    id: socket.id,
    user: <%- JSON.stringify(user._id) %>,
    requirement: <%- JSON.stringify(requirement._id) %>
  }
  socket.emit('private-message', data, (error) => {
     if (error) {
       console.log(error);
     }
  })
  $('#chat_message').val('');
  scrollSmoothToBottom()
}

function identifyUser(){

  var data = {
    message:"",
    id: socket.id,
    user: <%- JSON.stringify(user._id) %>,
    requirement: <%- JSON.stringify(requirement._id) %>
  }
  socket.emit('private-message', data, (error) => {
     if (error) {
       console.log(error);
     }
  })

}

function loadChat(){
    identifyUser();
    var talk =  <%- JSON.stringify(chat) %>;
    var client = <%- JSON.stringify(user) %>;

    talk.forEach(function(c){

      var div_row = $("<div>").attr("class","row no-gutters").appendTo('#chat_panel');
        if (String(c.user) == String(client._id)){
          var div_col = $("<div>").attr("class","col-md offset-md-3 offset-sm-3 offset-3").appendTo(div_row);
          var div_chat = $("<div>").attr("class","chat-bubble chat-bubble--right").append(c.message).appendTo(div_col);
        } else {
          var div_col = $("<div>").attr("class","col-md-9 col-sm-9 col-9").appendTo(div_row);
          var div_chat = $("<div>").attr("class","chat-bubble chat-bubble--left").append(c.message).appendTo(div_col);
        }
      var p_text = $("<p>").attr("style","float: right; font-size: 10px; margin-top: 15px; color: #e97676;").append(c.time).appendTo(div_chat);
    })
    scrollSmoothToBottom()
}

function scrollSmoothToBottom () {
   var div = document.getElementById("chat_panel");
   $('#chat_panel').animate({
      scrollTop: div.scrollHeight - div.clientHeight
   }, 500);
}
function downloadAll() {
  var all = $("a.file").map(function() {
    return window.open(this.href);
  }).get();
};
</script>
