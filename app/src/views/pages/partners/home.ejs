<%- include('../../partials/header'); -%>

<head>
  <link rel="stylesheet" href="/assets/styles/main.css" />
  <link rel="stylesheet" href="/assets/styles/partner.css" />

  <!-- Custom fonts for this template-->
  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
    crossorigin="anonymous"
  />
  <link
    href="/assets/styles/Client/fontawesome-free/css/all.css"
    rel="stylesheet"
    type="text/css"
  />
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 col-md-12">
        <div class="row">
          <div class="col-12 px-0">
            <%- include('../../partials/search-header.ejs'); -%>
          </div>
        </div>

        <div class="row mb-4">
          <div
            class="col-12 col-md-7 bigger-title red-text mb-2 font-weight-bold"
          >
            ¡Bienvenido <%= user.firstname %>!
          </div>
          <div class="col-12 col-md-5">
            <nav
              class="navbar navbar-expand-sm navbar-light bg-light justify-content-end"
              style="background-color: #ffffff !important;"
            >
              <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#navbarSupportedContent"
              >
                <span class="navbar-toggler-icon"></span>
              </button>
              <div
                class="collapse navbar-collapse flex-grow-0"
                id="navbarSupportedContent"
              >
                <ul class="navbar-nav text-right">
                  <li class="nav-item border-18 active mr-2 px-2">
                    <a class="nav-link" href="#start"><b>Inicio</b></a>
                  </li>
                  <li class="nav-item border-18 mr-2 px-2">
                    <a class="nav-link" href="#opportunities"
                      ><b>Oportunidades</b></a
                    >
                  </li>
                  <li class="nav-item border-18 mr-2 px-2">
                    <a class="nav-link" href="#referred"><b>Referidos</b></a>
                  </li>
                </ul>
              </div>
            </nav>
          </div>
        </div>
        <div class="row" id="start">
          <div class="col-12 col-md-7 mb-3">
            <div class="card asilinks-card white-bg black-shadow">
              <div class="card-body small-title">
                <div class="row mb-3">
                  <div class="col-10 left-hor mid-title red-text">
                    <b>Mis finanzas</b>
                  </div>
                  <div
                    class="col-2 center-hor mid-title dropdown-settings dropleft"
                    data-toggle="walletDropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <button class="more-btn rounded-circle px-1 red-text">
                      <i class="fas fa-ellipsis-h"></i>
                    </button>
                    <div class="dropdown-content" id="walletDropdown">
                      <a href="/partner/wallet">Ver wallet</a>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <canvas id="finances" height="215"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-5 mb-3">
            <div class="card asilinks-card white-bg black-shadow">
              <div class="card-body small-title">
                <div class="row mb-3">
                  <div class="col-10 left-hor mid-title red-text">
                    <b>Esta semana</b>
                  </div>
                  <div class="col-2 center-hor mid-title">
                    <button class="more-btn rounded-circle px-1 red-text">
                      <i class="fas fa-ellipsis-h"></i>
                    </button>
                  </div>
                </div>
                <div class="row py-1">
                  <div class="col-2 text-24 center-vert">
                    <b>L</b>
                  </div>
                  <!--
                                    <div class="col-10 light-gray-bg border-10 py-2">
                                        <div class="row py-1">
                                            <div class="col-12">
                                                Levantamiento de requerimientos
                                            </div>
                                        </div>
                                        <div class="row py-1">
                                            <div class="col-12">
                                                <div class="border-7 px-2 clients" style="display: inline-block;">
                                                    <b>Roberto Romero</b>
                                                </div>
                                            </div>
                                        </div>
                                    </div>-->
                </div>
                <div class="row py-1">
                  <div class="col-2 text-24 center-vert">
                    <b>M</b>
                  </div>
                  <!--
                                    <div class="col-10 light-gray-bg border-10 py-2">
                                        <div class="row py-1">
                                            <div class="col-12">
                                                Entrega documento branding
                                            </div>
                                        </div>
                                        <div class="row py-1">
                                            <div class="col-12">
                                                <div class="border-7 px-2 clients" style="display: inline-block;">
                                                    <b>Angélica Gómez</b>
                                                </div>
                                            </div>
                                        </div>
                                    </div>-->
                </div>
                <div class="row py-1">
                  <div class="col-2 text-24 center-vert">
                    <b>M</b>
                  </div>
                  <div class="col-10 border-10 py-2"></div>
                </div>
                <div class="row py-1">
                  <div class="col-2 text-24 center-vert">
                    <b>J</b>
                  </div>
                  <div class="col-10 border-10 py-2"></div>
                </div>
                <div class="row py-1">
                  <div class="col-2 text-24 center-vert">
                    <b>V</b>
                  </div>
                  <!--
                                    <div class="col-10 light-gray-bg border-10 py-2">
                                        <div class="row py-1">
                                            <div class="col-12">
                                                Entrega ilustación UPA
                                            </div>
                                        </div>
                                        <div class="row py-1">
                                            <div class="col-12">
                                                <div class="border-7 px-2 clients" style="display: inline-block;">
                                                    <b>Kelly Colmenares</b>
                                                </div>
                                            </div>
                                        </div>
                                    </div>-->
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row mb-3" id="opportunities">
          <% if (opportunities && opportunities.length > 0) { %>
          <div class="col-12 mb-3">
            <div class="card asilinks-card white-bg black-shadow">
              <div class="card-body small-title">
                <div class="row mb-3">
                  <div class="col-md-12 left-hor mid-title red-text">
                    <b
                      >¡Has hecho match con <%= opportunities.length %> nueva(s)
                      oportunidad(es)!</b
                    >
                  </div>
                </div>
                <div class="row task-opportunity" id="task-opportunity">
                  <% opportunities.forEach(function(opp){ %>
                  <div class="col-12 col-md-4 mb-3">
                    <a
                      class="stretched-link"
                      href="/partner/opportunity/<%= opp._id %>"
                    >
                    </a>
                    <div
                      class="card asilinks-card white-bg black-shadow card-decoration"
                      style="border-radius: 21px !important;"
                    >
                      <div class="row no-gutters">
                        <div
                          class="col-2 card-decoration task"
                          id="task1"
                        ></div>
                        <div class="col-10">
                          <div class="card-body small-title">
                            <div class="row">
                              <div class="col-12 left-hor small-title">
                                <b><%= opp.name %></b>
                              </div>
                              <div class="col-12 left-hor small-title">
                                <%= opp.client.firstname %> <%=
                                opp.client.lastname %>
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-12">
                                <div class="task-tag px-2 my-2 d-inline-block">
                                  <%= opp.development_time %>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% }); %>
                </div>
              </div>
            </div>
          </div>
          <% } %>
          <div class="col-12">
            <div class="card asilinks-card white-bg black-shadow">
              <div class="card-body small-title">
                <div class="row mb-3">
                  <div class="col-md-12 left-hor mid-title red-text">
                    <b>Mis oportunidades</b>
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-12 hor-btn-group">
                    <div
                      class="btn-group btn-group-sm d-flex border-18 pink-bg"
                      role="group"
                    >
                      <button
                        type="button"
                        class="btn opportunity-btn w-100"
                        data-toggle="collapse"
                        data-target="#all"
                      >
                        Todas
                      </button>
                      <button
                        type="button"
                        class="btn opportunity-btn w-100"
                        data-toggle="collapse"
                        data-target="#active"
                      >
                        Activas
                      </button>
                      <button
                        type="button"
                        class="btn opportunity-btn w-100"
                        data-toggle="collapse"
                        data-target="#notStarted"
                      >
                        Sin iniciar
                      </button>
                      <button
                        type="button"
                        class="btn opportunity-btn w-100"
                        data-toggle="collapse"
                        data-target="#cancelled"
                      >
                        Cancelados
                      </button>
                      <button
                        type="button"
                        class="btn opportunity-btn w-100"
                        data-toggle="collapse"
                        data-target="#finished"
                      >
                        Terminadas
                      </button>
                    </div>
                  </div>
                  <div class="col-12 two-btn-group">
                    <div class="row">
                      <div class="col-12 mb-3">
                        <div
                          class="btn-group btn-group-sm d-flex border-18 pink-bg"
                          role="group"
                        >
                          <button
                            type="button"
                            class="btn opportunity-btn w-100"
                            data-toggle="collapse"
                            data-target="#all"
                          >
                            Todas
                          </button>
                          <button
                            type="button"
                            class="btn opportunity-btn w-100"
                            data-toggle="collapse"
                            data-target="#active"
                          >
                            Activas
                          </button>
                        </div>
                      </div>
                      <div class="col-12">
                        <div
                          class="btn-group btn-group-sm d-flex border-18 pink-bg"
                          role="group"
                        >
                          <button
                            type="button"
                            class="btn opportunity-btn w-100"
                            data-toggle="collapse"
                            data-target="#notStarted"
                          >
                            Sin iniciar
                          </button>
                          <button
                            type="button"
                            class="btn opportunity-btn w-100"
                            data-toggle="collapse"
                            data-target="#cancelled"
                          >
                            Cancelados
                          </button>
                          <button
                            type="button"
                            class="btn opportunity-btn w-100"
                            data-toggle="collapse"
                            data-target="#finished"
                          >
                            Terminadas
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row collapse task-list" id="all">
                  <!--<div class="col-12 col-md-4 mb-3">
                                        <div class="card asilinks-card white-bg black-shadow card-decoration">
                                            <div class="row no-gutters">
                                                <div class="col-2 card-decoration task" id="task0">
                                                </div>
                                                <div class="col-10">
                                                    <div class="card-body small-title">
                                                        <div class="row">
                                                            <div class="col-12 left-hor small-title">
                                                                <b>Tinder para mascotas</b>
                                                            </div>
                                                            <div class="col-12 left-hor small-title">
                                                                Roberto Romero
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <div class="task-tag px-2 my-2 d-inline-block">
                                                                    diseño
                                                                </div>
                                                                <div class="task-tag px-2 d-inline-block">
                                                                    diseño web/móvil
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-12 col-md-4">
                                                                <b>Tiempo estimado</b><br>
                                                                3 semanas
                                                            </div>
                                                            <div class="col-12 col-md-4">
                                                                <b>Entrega</b><br>
                                                                20/12/2020
                                                            </div>
                                                            <div class="col-12 col-md-4">
                                                                <b>Precio</b><br>
                                                                $300
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-12 col-md-4">
                                                            </div>
                                                            <div class="col-12 col-md-4">
                                                            </div>
                                                            <div class="col-12 col-md-4">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>-->
                </div>
                <div class="row collapse task-list" id="active"></div>
                <div class="row collapse task-list" id="notStarted"></div>
                <div class="row collapse task-list" id="cancelled"></div>
                <div class="row collapse task-list" id="finished"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="row" id="referred">
          <div class="col-12 mb-3">
            <div class="card asilinks-card orange-bg red-shadow">
              <div class="card-body small-title">
                <div class="row my-3">
                  <div class="col-12 center-hor bigger-title">
                    <b>¿Conoces a alguien perfecto para Asilinks?</b>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12 center-hor">
                    <form class="form-inline">
                      <div
                        class="input-group partner-input"
                        style="margin: auto;"
                      >
                        <input
                          type="email"
                          class="form-control"
                          id="inviteEmail"
                          placeholder="johnsmith@gmail.com"
                          required
                        />
                        <div class="input-group-append">
                          <button
                            class="input-group-text py-1 px-4"
                            id="inviteBtn"
                          >
                            Invitar
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="card asilinks-card white-bg black-shadow">
              <div class="card-body small-title">
                <div class="row mb-3">
                  <div class="col-md-12 left-hor mid-title red-text">
                    <b>Mis referidos</b>
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-12">
                    <div
                      class="btn-group btn-group-sm d-flex border-18 pink-bg"
                      role="group"
                    >
                      <button
                        type="button"
                        class="btn referred-btn w-100"
                        data-toggle="collapse"
                        data-target="#allRef"
                      >
                        Todos
                      </button>
                      <button
                        type="button"
                        class="btn referred-btn w-100"
                        data-toggle="collapse"
                        data-target="#clients"
                      >
                        Clientes
                      </button>
                      <button
                        type="button"
                        class="btn referred-btn w-100"
                        data-toggle="collapse"
                        data-target="#partners"
                      >
                        Socios
                      </button>
                    </div>
                  </div>
                </div>
                <% if (invitedUsers) { %>
                <div class="row collapse referred-list" id="allRef">
                  <% invitedUsers.forEach(function(inv){ %>
                  <div class="col-6 col-md-4 mb-3">
                    <div class="card asilinks-card white-bg black-shadow">
                      <img
                        class="card-img-top"
                        src="<%= inv.photo %>"
                        alt="Card image cap"
                      />
                      <div class="card-body small-title">
                        <div class="row">
                          <div class="col-12 left-hor small-title">
                            <b><%= inv.firstname %> <%= inv.lastname %></b>
                          </div>
                          <!--<div class="col-12 left-hor small-title">
                                                        Referido el <%= inv.photo%>
                                                    </div>-->
                        </div>
                        <div class="row">
                          <div class="col-12">
                            <% if (inv.worker) { %>
                            <div
                              class="client-tag px-2 my-2"
                              style="display: inline-block;"
                            >
                              cliente
                            </div>
                            <% } else { %>
                            <div
                              class="partner-tag px-2 my-2"
                              style="display: inline-block;"
                            >
                              socio
                            </div>
                            <% } %>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% }) %>
                </div>
                <div class="row collapse referred-list" id="clients">
                  <% invitedUsers.forEach(function(inv){ %> <% if (inv.worker) {
                  %>
                  <div class="col-6 col-md-4 mb-3">
                    <div class="card asilinks-card white-bg black-shadow">
                      <img
                        class="card-img-top"
                        src="<%= inv.photo %>"
                        alt="Card image cap"
                      />
                      <div class="card-body small-title">
                        <div class="row">
                          <div class="col-12 left-hor small-title">
                            <b><%= inv.firstname %> <%= inv.lastname %></b>
                          </div>
                          <!--<div class="col-12 left-hor small-title">
                                                        Referido el <%= inv.photo%>
                                                    </div>-->
                        </div>
                        <div class="row">
                          <div class="col-12">
                            <div
                              class="client-tag px-2 my-2"
                              style="display: inline-block;"
                            >
                              cliente
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% } %> <% }) %>
                </div>
                <div class="row collapse referred-list" id="partners">
                  <% invitedUsers.forEach(function(inv){ %> <% if (!inv.worker)
                  { %>
                  <div class="col-6 col-md-4 mb-3">
                    <div class="card asilinks-card white-bg black-shadow">
                      <img
                        class="card-img-top"
                        src="<%= inv.photo %>"
                        alt="Card image cap"
                      />
                      <div class="card-body small-title">
                        <div class="row">
                          <div class="col-12 left-hor small-title">
                            <b><%= inv.firstname %> <%= inv.lastname %></b>
                          </div>
                          <!--<div class="col-12 left-hor small-title">
                                                        Referido el <%= inv.photo%>
                                                    </div>-->
                        </div>
                        <div class="row">
                          <div class="col-12">
                            <div
                              class="partner-tag px-2 my-2"
                              style="display: inline-block;"
                            >
                              socio
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% } %> <% }) %>
                </div>
                <% } %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hack pass variable backend to frontend dinamically -->
  <span id="variableWalletGraphic" hidden>
    <%- JSON.stringify(wallet) %>
  </span>
</body>

<%- include('../../partials/sub-footer'); -%>

<script type="text/javascript" src="/assets/scripts/loading-bar.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

<script type="text/javascript">
  $("#inviteEmail").change(function () {
    if (!$(this).val()) $("#inviteBtn").prop("disabled", true);
    else $("#inviteBtn").prop("disabled", false);
  });

  $("#inviteBtn").click(function () {
    var name = $("input#inviteEmail").val();

    if (!name)
      return Swal.fire({
        title: "Error!",
        text: "No se ha especificado ningún usuario a invitar!",
        icon: "error",
        confirmButtonText: "Volver",
      });
    $(this).empty();
    $(this).html("<div class='asilinks-loader mx-auto'> </div>");

    $.post("/partner/inviteUser", { email: name })
      .done(function (data) {
        Swal.fire({
          title: "Éxito!",
          text: data,
          icon: "success",
          confirmButtonText: "Volver",
        });
      })
      .fail(function (data) {
        Swal.fire({
          title: "Error!",
          text: data.responseText,
          icon: "error",
          confirmButtonText: "Volver",
        });
      })
      .always(function () {
        $("#inviteBtn").empty();
        $("#inviteBtn").text("Invitar");
      });

    return false;
  });
</script>

<script type="text/javascript">
  $(document).ready(function () {
    $("#inviteBtn").prop("disabled", true);

    $(".opportunity-btn").click(function () {
      $(".task-list").collapse("hide");
      $(this).collapse("show");
    });

    $(".referred-btn").click(function () {
      $(".referred-list").collapse("hide");
      $(this).collapse("show");
    });
  });

  $(".nav-item").on("click", function () {
    $(".nav-item.active").removeClass("active");
    $(this).addClass("active");
  });

  $(".opportunity-btn").on("click", function () {
    var toCollapse = $(this).data("target");
    var sameBtn = $("*[data-target='" + toCollapse + "']");

    $(".opportunity-btn.active").not($(sameBtn)).removeClass("active");

    if ($(sameBtn).hasClass("active")) $(sameBtn).removeClass("active");
    else $(sameBtn).addClass("active");
  });

  $(".referred-btn").on("click", function () {
    $(".referred-btn.active").not($(this)).removeClass("active");

    if ($(this).hasClass("active")) $(this).removeClass("active");
    else $(this).addClass("active");
  });

  var colors = ["green-bg", "red-bg", "pinker-bg", "blue-bg"];

  var random = Math.floor(Math.random() * colors.length);

  var clients = $(".clients");
  for (var i = 0; i < 5; i++) {
    $(clients[i]).addClass(colors[random]);
    random = Math.floor(Math.random() * colors.length) + 0;
  }

  var tasks = $(".task");

  for (var i = 0; i < tasks.length; i++) {
    $(tasks[i]).addClass(colors[random]);
    random = Math.floor(Math.random() * colors.length) + 0;
  }
</script>

<script>
  // Agrega los meses si 5 meses hacia atras es negativo
  function previousYear(lastMonths, allMonths, minusX) {
    var reverseMonths = allMonths.reverse();
    var count = 0;

    // Si se quiere cambiar el limite de meses se cambia la condicion del length y el minusX mas abajo
    while (minusX != 0 && lastMonths.length < 5) {
      lastMonths.push(allMonths[count]);
      count++;
      minusX++;
    }

    return lastMonths;
  }

  // Selecciona los ultimos meses para mostrar en la grafica
  function lastMonths() {
    var allMonths = [
      "Enero",
      "Febrero",
      "Marzo",
      "Abril",
      "Mayo",
      "Junio",
      "Julio",
      "Agosto",
      "Septiembre",
      "Octubre",
      "Noviembre",
      "Diciembre",
    ];

    var date = new Date();
    var lastMonths = [];

    var month = date.getMonth();

    // Si se quiere cambiar el limite de meses se cambia la condicion del length y el minusX mas abajo
    while (month >= 0 && lastMonths.length < 12) {
      lastMonths.push(allMonths[month]);
      month--;
    }

    // Para ver si se necesitan agregar meses del año pasado.
    // Como se incluye el mismo mes, es (meses al pasado + 1), ej. 5 meses es  (mes actual) - 4
    var minusX = month - 4;
    if (minusX < 0) lastMonths = previousYear(lastMonths, allMonths, minusX);

    console.log(lastMonths);
    return lastMonths;
  }

  var wallet = JSON.parse(
    document.getElementById("variableWalletGraphic").innerText
  );
  var resEne = 0;
  var sumEne = 0;
  var sumFeb = 0;
  var resFeb = 0;
  var sumMar = 0;
  var resMar = 0;
  var sumAbr = 0;
  var resAbr = 0;
  var sumMay = 0;
  var resMay = 0;
  var sumJun = 0;
  var resJun = 0;
  var sumJul = 0;
  var resJul = 0;
  var sumAgo = 0;
  var resAgo = 0;
  var sumSep = 0;
  var resSep = 0;
  var sumOct = 0;
  var resOct = 0;
  var sumNov = 0;
  var resNov = 0;
  var sumDic = 0;
  var resDic = 0;

  for (x in wallet) {
    if (wallet[x].status == "Aprobada") {
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 01
      ) {
        resEne += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 01
      ) {
        sumEne += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 02
      ) {
        resFeb += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 02
      ) {
        sumFeb += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 03
      ) {
        resMar += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 03
      ) {
        sumMar += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 04
      ) {
        resAbr += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 04
      ) {
        sumAbr += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 05
      ) {
        resMay += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 05
      ) {
        sumMay += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 06
      ) {
        resJun += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 06
      ) {
        sumJun += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 07
      ) {
        resJul += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 07
      ) {
        sumJul += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 08
      ) {
        resAgo += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 08
      ) {
        sumAgo += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 09
      ) {
        resSep += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 09
      ) {
        sumSep += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 10
      ) {
        resOct += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 10
      ) {
        sumOct += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 11
      ) {
        resNov += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 11
      ) {
        sumNov += parseFloat(wallet[x].rechargeWallet.amount);
      }
      if (
        wallet[x].retirementWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 12
      ) {
        resDic += parseFloat(wallet[x].retirementWallet.amount);
      } else if (
        wallet[x].rechargeWallet &&
        moment(wallet[x].timeStampCreate).format("MM") == 12
      ) {
        sumDic += parseFloat(wallet[x].rechargeWallet.amount);
      }
    }
  }

  var Enero = sumEne - resEne;
  var Febrero = sumFeb - resFeb;
  var Marzo = sumMar - resMar;
  var Abril = sumAbr - resAbr;
  var Mayo = sumMay - resMay;
  var Junio = sumJun - resJun;
  var Julio = sumJul - resJul;
  var Agosto = sumAgo - resAgo;
  var Septiembre = sumSep - resSep;
  var Octubre = sumOct - resOct;
  var Noviembre = sumNov - resNov;
  var Diciembre = sumDic - resDic;

  // Últimos 5 meses para la grafica
  var lastMonths = lastMonths().reverse();
  var ctx = document.getElementById("finances").getContext("2d");
  var myChart = new Chart(ctx, {
    type: "line",
    data: {
      labels: lastMonths,
      datasets: [
        {
          label: "Ingresos",
          data: [
            Enero,
            Febrero,
            Marzo,
            Abril,
            Mayo,
            Junio,
            Julio,
            Agosto,
            Septiembre,
            Octubre,
            Noviembre,
            Diciembre,
          ],
          backgroundColor: "rgba(255, 239, 239, 0.8)",
          borderColor: "rgba(231, 66, 102, 0.8)",
          borderWidth: 5,
          fill: true,
        },
      ],
    },
    options: {
      responsive: true,
      title: {
        display: false,
        text: "Ingresos por mes",
      },
      tooltips: {
        mode: "index",
        intersect: false,
      },
      hover: {
        mode: "nearest",
        intersect: true,
      },
      scales: {
        xAxes: [
          {
            display: true,
            scaleLabel: {
              display: false,
              labelString: "Mes",
            },
          },
        ],
        yAxes: [
          {
            display: true,
            scaleLabel: {
              display: false,
              labelString: "Ingresos",
            },
            ticks: {
              // Include a dollar sign in the ticks
              callback: function (value, index, values) {
                return value + "$";
              },
            },
          },
        ],
      },
      tooltips: {
        mode: "index",
        intersect: false,
        yPadding: 10,
        xPadding: 10,
        caretSize: 8,
        backgroundColor: "white",
        titleFontColor: "black",
        bodyFontColor: "black",
        borderColor: "rgba(240, 241, 242,1)",
        borderWidth: 2,
        callbacks: {
          label: function (tooltipItem, data) {
            var label = data.datasets[tooltipItem.datasetIndex].label || "";
            label += ": " + tooltipItem.yLabel + "$";
            return label;
          },
        },
      },
      legend: {
        display: false,
      },
    },
  });
</script>
